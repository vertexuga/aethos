---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - vite.config.js
  - tailwind.config.js
  - index.html
  - src/main.jsx
  - src/App.jsx
  - src/index.css
  - src/pages/HomePage.jsx
  - src/pages/GamePage.jsx
  - src/components/ParticleCanvas.jsx
  - src/components/CustomCursor.jsx
  - src/components/MenuLink.jsx
  - src/game/engine/GameEngine.js
  - src/game/engine/GameLoop.js
  - src/stores/gameStore.js
autonomous: true

must_haves:
  truths:
    - "Navigating to / shows the existing dark mystical main menu with all 5 menu items"
    - "Clicking Begin Journey navigates to /game and shows a full-screen Canvas"
    - "The Canvas renders a dark background at 60 FPS via requestAnimationFrame"
    - "Navigating back to / from /game does not leak animation frames"
    - "The game loop uses fixed timestep accumulator with 16.67ms physics steps"
  artifacts:
    - path: "package.json"
      provides: "Vite + React 19 + Tailwind CSS 4 + React Router + Zustand project"
      contains: "zustand"
    - path: "src/pages/HomePage.jsx"
      provides: "Main menu with existing dark mystical aesthetic"
      min_lines: 50
    - path: "src/pages/GamePage.jsx"
      provides: "Game page mounting Canvas with engine lifecycle"
      min_lines: 30
    - path: "src/game/engine/GameLoop.js"
      provides: "Fixed timestep accumulator game loop"
      contains: "FIXED_TIMESTEP"
    - path: "src/game/engine/GameEngine.js"
      provides: "Engine orchestrator managing canvas, loop, systems"
      exports: ["GameEngine"]
    - path: "src/stores/gameStore.js"
      provides: "Zustand store bridging Canvas engine and React UI"
      exports: ["useGameStore"]
  key_links:
    - from: "src/pages/GamePage.jsx"
      to: "src/game/engine/GameEngine.js"
      via: "useRef + useEffect lifecycle"
      pattern: "new GameEngine"
    - from: "src/pages/GamePage.jsx"
      to: "requestAnimationFrame cleanup"
      via: "useEffect cleanup function"
      pattern: "engine\\.stop|engine\\.destroy"
    - from: "src/App.jsx"
      to: "src/pages/GamePage.jsx"
      via: "React Router Route"
      pattern: "Route.*path.*game"
    - from: "src/game/engine/GameEngine.js"
      to: "src/stores/gameStore.js"
      via: "direct import"
      pattern: "useGameStore\\.getState"
---

<objective>
Scaffold the Vite + React project and build the core Canvas game loop with fixed timestep physics, React Router navigation from the existing main menu to the game screen, and Zustand state bridge.

Purpose: This is the foundation everything else builds on. The game loop, Canvas rendering, and React/Canvas bridge pattern must be solid from day one. Delta time and proper cleanup prevent bugs that compound across all future phases.

Output: A running Vite dev server with the existing main menu at `/`, a Canvas game screen at `/game`, a fixed timestep game loop rendering at 60 FPS, and a Zustand store connecting the two layers.
</objective>

<execution_context>
@/Users/johnsong/.claude/get-shit-done/workflows/execute-plan.md
@/Users/johnsong/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@example_frontend.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Vite project scaffold with React, Tailwind, Router, Zustand, and existing menu</name>
  <files>
    package.json
    vite.config.js
    tailwind.config.js
    index.html
    src/main.jsx
    src/App.jsx
    src/index.css
    src/pages/HomePage.jsx
    src/components/ParticleCanvas.jsx
    src/components/CustomCursor.jsx
    src/components/MenuLink.jsx
    src/stores/gameStore.js
  </files>
  <action>
    1. Initialize a Vite project in the repo root (NOT in a subdirectory): `npm create vite@latest . -- --template react`. If prompted about existing files, proceed (only example_frontend.js and .planning/ exist).

    2. Install dependencies: `npm install react-router-dom zustand` and `npm install -D tailwindcss @tailwindcss/vite`

    3. Configure vite.config.js to use the Tailwind CSS Vite plugin:
    ```js
    import { defineConfig } from 'vite'
    import react from '@vitejs/plugin-react'
    import tailwindcss from '@tailwindcss/vite'

    export default defineConfig({
      plugins: [react(), tailwindcss()],
    })
    ```

    4. Configure src/index.css with Tailwind v4 import: `@import "tailwindcss";` plus the custom CSS from example_frontend.js (the @keyframes for float and rotate-slow, the Google Fonts @import, and custom utility classes for the color palette). Define these as CSS custom properties at :root level matching the existing customStyles.root values.

    5. Extract the existing example_frontend.js into proper components:
      - src/components/MenuLink.jsx -- The MenuLink component as-is but with proper React Router Link for "Begin Journey" (navigates to /game). All other menu items stay as non-functional links for now. Use inline styles matching the existing aesthetic exactly.
      - src/components/ParticleCanvas.jsx -- The ParticleCanvas component exactly as-is. This is the background particle effect for the menu, NOT the game Canvas. Keep the useRef + requestAnimationFrame + cancelAnimationFrame cleanup pattern.
      - src/components/CustomCursor.jsx -- The CustomCursor component exactly as-is.
      - src/pages/HomePage.jsx -- The HomePage component, importing MenuLink, ParticleCanvas, CustomCursor. Import `useNavigate` from 'react-router-dom' and call `const navigate = useNavigate()` inside the component. Reproduce the exact layout, SVG decorations, gradient backgrounds, and text from example_frontend.js. The "Begin Journey" MenuLink gets an onClick that calls `navigate('/game')`.

    6. Set up src/App.jsx with BrowserRouter wrapping Routes:
      - Route "/" -> HomePage
      - Route "/game" -> GamePage (created in Task 2)

    7. Set up src/main.jsx to render App into #root.

    8. Create index.html with the Google Fonts link (Cinzel Decorative, Cormorant Garamond, Playfair Display) in the head. Set body background to #0a0a12.

    9. Create src/stores/gameStore.js -- Zustand store with initial slices:
    ```js
    import { create } from 'zustand';

    export const useGameStore = create((set, get) => ({
      // Game state
      gameState: 'menu', // 'menu' | 'playing' | 'paused'
      fps: 0,

      // Player state (placeholder for future phases)
      playerHP: 100,
      playerMaxHP: 100,
      mana: 0,
      maxMana: 100,

      // Actions
      setGameState: (state) => set({ gameState: state }),
      setFPS: (fps) => set({ fps }),
    }));
    ```

    IMPORTANT: Do NOT use Tailwind CSS v3 syntax (no @tailwind directives, no tailwind.config.js content/theme). Tailwind v4 uses `@import "tailwindcss"` and CSS-based config. If you need custom theme values, use @theme in the CSS file or CSS custom properties.
  </action>
  <verify>
    Run `npm run dev` and confirm:
    1. Dev server starts without errors
    2. Navigate to http://localhost:5173 -- main menu renders with dark mystical theme
    3. All 5 menu items visible (Begin Journey, Archives, Sigils, Settings, Depart)
    4. Particle background animates
    5. Custom cursor follows mouse
    6. Hover effects work on menu items (gold highlight, diamond indicator, subtitle fade)
    7. No console errors
  </verify>
  <done>
    Main menu at localhost:5173/ matches the existing example_frontend.js aesthetic. All visual elements (particles, cursor, SVG decorations, gradients, fonts) render correctly. React Router is configured with / and /game routes. Zustand store is importable.
  </done>
</task>

<task type="auto">
  <name>Task 2: Canvas game loop engine with fixed timestep and GamePage</name>
  <files>
    src/pages/GamePage.jsx
    src/game/engine/GameLoop.js
    src/game/engine/GameEngine.js
  </files>
  <action>
    1. Create src/game/engine/GameLoop.js -- A class encapsulating the fixed timestep accumulator pattern:
    ```
    class GameLoop {
      constructor(updateFn, renderFn) -- stores callbacks
      FIXED_TIMESTEP = 1000 / 60 (16.67ms)
      accumulator = 0
      lastTime = 0
      running = false
      rafId = null
      frameCount = 0
      fpsTimer = 0

      start() -- sets running=true, calls requestAnimationFrame(this.tick)
      stop() -- sets running=false, calls cancelAnimationFrame(this.rafId)
      tick(currentTime) -- the core loop:
        - Calculate deltaTime = currentTime - lastTime (cap at 250ms to prevent spiral of death)
        - lastTime = currentTime
        - accumulator += deltaTime
        - while (accumulator >= FIXED_TIMESTEP): call updateFn(FIXED_TIMESTEP / 1000), accumulator -= FIXED_TIMESTEP
        - Call renderFn(accumulator / FIXED_TIMESTEP) with interpolation factor
        - Track FPS: increment frameCount, every 1000ms compute fps = frameCount, reset
        - If running, requestAnimationFrame(this.tick)
    ```
    Bind this.tick in constructor to preserve context. The deltaTime cap at 250ms prevents the accumulator from running away when the tab is backgrounded.

    2. Create src/game/engine/GameEngine.js -- The orchestrator class:
    ```
    class GameEngine {
      constructor(canvas) -- stores canvas ref, gets 2d context
      canvas, ctx -- the rendering surface
      gameLoop -- GameLoop instance
      width, height -- canvas dimensions
      systems = [] -- array for future systems (InputSystem, PhysicsSystem, etc.)

      init() -- sets canvas size to window dimensions, creates GameLoop with this.update and this.render bound, adds resize listener, starts the loop
      update(dt) -- called by GameLoop at fixed timestep. Iterates systems calling system.update(dt). Updates FPS in Zustand store via useGameStore.getState().setFPS(fps).
      render(interpolation) -- called by GameLoop each frame. Clears canvas with #0a0a12 fill. Iterates systems calling system.render(ctx, interpolation). Draws an FPS counter in top-left corner (small, semi-transparent text) for debugging.
      addSystem(system) -- pushes to systems array
      resize() -- updates canvas width/height to window dimensions
      destroy() -- stops game loop, removes resize listener, clears references. This is critical for preventing RAF leaks.
    ```

    3. Create src/pages/GamePage.jsx:
    ```jsx
    - Uses useRef for canvas element
    - Uses useEffect (empty deps) to:
      a. Create new GameEngine(canvasRef.current)
      b. Call engine.init()
      c. Update Zustand gameState to 'playing'
      d. Return cleanup function that calls engine.destroy() and sets gameState back to 'menu'
    - Renders a full-screen div with:
      a. A canvas element (ref={canvasRef}) that fills the viewport
      b. A "Back to Menu" button in top-left corner using React Router's useNavigate, styled in the existing aesthetic (Cinzel Decorative font, teal/gold colors, semi-transparent background)
      c. An FPS display in top-right corner reading from useGameStore fps slice
    - Canvas should have style={{ display: 'block' }} to prevent scrollbar issues
    - The container div should have the dark background color as fallback
    ```

    4. Render a test visual in GameEngine.render() to prove the loop works: draw a small teal circle that moves in a sine wave pattern across the screen. Use a class-level `this.testTime` that increments in update(dt) and drives the sine position. This proves delta-time-independent movement -- the circle should move at the same speed regardless of monitor refresh rate.

    IMPORTANT: The Canvas in GamePage is the GAME canvas (full-screen, for gameplay). It is completely separate from the ParticleCanvas component (which is a background decoration for the menu). Do not confuse them.
  </action>
  <verify>
    Run `npm run dev` and confirm:
    1. Click "Begin Journey" on the main menu -- navigates to /game
    2. Full-screen dark canvas appears with teal test circle moving smoothly
    3. FPS counter shows ~60 FPS in the corner
    4. Click "Back to Menu" -- navigates back to / without console errors
    5. Navigate to /game again -- animation restarts cleanly (no doubled animations, no stale state)
    6. Open browser DevTools, check for cancelAnimationFrame calls on unmount (no RAF leak warnings)
    7. In DevTools Performance tab, verify consistent 16.67ms update calls
  </verify>
  <done>
    Clicking "Begin Journey" opens a full-screen Canvas game screen at /game. A teal test circle moves smoothly via fixed timestep game loop. FPS counter shows ~60. Navigating away and back produces no frame leaks or crashes. The game loop uses delta time for frame-rate-independent physics. Zustand store reflects gameState changes.
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. Main menu at / renders with full dark mystical aesthetic (particles, cursor, SVG, gradients, fonts)
3. Begin Journey navigates to /game showing Canvas with test animation at 60 FPS
4. Back to Menu navigates to / cleanly
5. Round-trip navigation (menu -> game -> menu -> game) produces no errors, no frame leaks, no performance degradation
6. FPS counter visible and reading ~60
7. Zustand store gameState toggles between 'menu' and 'playing' on navigation
8. No console warnings or errors throughout
</verification>

<success_criteria>
- FOUND-01: Vite + React 19 + Tailwind CSS 4 + React Router project runs
- FOUND-02: Canvas rendering layer isolated from React via useRef in GamePage
- FOUND-03: Fixed timestep game loop with 16.67ms updates and delta time passed to update
- FOUND-05: Zustand store exists with gameState, fps, playerHP slices
- FOUND-06: requestAnimationFrame cleanup on GamePage unmount via engine.destroy()
- UIHD-01: Main menu renders all 5 items with existing design
- UIHD-09: Dark mystical aesthetic preserved (teal/gold/navy, Cinzel Decorative font)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
